<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ¤° AI Risk Assessment Results</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
<div class="container-fluid">
    <!-- Header -->
    <div class="row bg-primary text-white py-3 mb-4">
        <div class="col-12">
            <div class="container">
                <h1 class="display-4 mb-0">
                    <i class="fas fa-robot text-warning me-2"></i>
                    AI Risk Assessment Results
                </h1>
                <p class="lead mb-0">Advanced AI analysis completed</p>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Success Results -->
        <div th:if="${success}" class="row">
            <!-- Main Result -->
            <div class="col-lg-8 mb-4">
                <div class="card shadow-lg">
                    <div class="card-header text-white"
                         th:classappend="${prediction != null and (prediction['riskLevel'] == 'HIGH' or prediction['riskLevel'] == 'high risk' or prediction['riskLevel'] == '2')} ? 'bg-danger' :
                              (${prediction != null and (prediction['riskLevel'] == 'MEDIUM' or prediction['riskLevel'] == 'medium risk' or prediction['riskLevel'] == '1')} ? 'bg-warning' : 'bg-success')">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-chart-pie me-2"></i>
                            Risk Assessment Result
                        </h3>
                    </div>
                    <div class="card-body">
                        <!-- Risk Level Display -->
                        <div class="text-center mb-4">
                            <div class="risk-level-display p-4 rounded-circle mx-auto mb-3"
                                 th:classappend="${prediction != null and (prediction['riskLevel'] == 'HIGH' or prediction['riskLevel'] == 'high risk' or prediction['riskLevel'] == '2')} ? 'bg-danger' :
                                  (${prediction != null and (prediction['riskLevel'] == 'MEDIUM' or prediction['riskLevel'] == 'medium risk' or prediction['riskLevel'] == '1')} ? 'bg-warning' : 'bg-success')"
                                 style="width: 200px; height: 200px; display: flex; align-items: center; justify-content: center;">
                                <h1 class="text-white mb-0" th:text="${prediction != null ? (prediction['riskLevel'] == '2' ? 'HIGH RISK' :
                                                                           prediction['riskLevel'] == '1' ? 'MEDIUM RISK' :
                                                                           prediction['riskLevel'] == '0' ? 'LOW RISK' :
                                                                           prediction['riskLevel']) : 'UNKNOWN'}">RISK LEVEL</h1>
                            </div>
                            <h4 class="mb-3">
                                Confidence:
                                <span class="badge bg-primary fs-6"
                                      th:text="${prediction != null and prediction['confidence'] != null ? #numbers.formatPercent(prediction['confidence'], 1, 1) : '85%'}">85%</span>
                            </h4>
                        </div>

                        <!-- Interpretation -->
                        <div class="alert"
                             th:classappend="${prediction != null and (prediction['riskLevel'] == 'HIGH' or prediction['riskLevel'] == 'high risk' or prediction['riskLevel'] == '2')} ? 'alert-danger' :
                                (${prediction != null and (prediction['riskLevel'] == 'MEDIUM' or prediction['riskLevel'] == 'medium risk' or prediction['riskLevel'] == '1')} ? 'alert-warning' : 'alert-success')">
                            <h5 class="alert-heading">
                                <i class="fas fa-info-circle me-2"></i>
                                Medical Interpretation
                            </h5>
                            <p class="mb-0" th:text="${prediction != null and prediction['interpretation'] != null ? prediction['interpretation'] :
                                       (prediction != null and (prediction['riskLevel'] == 'HIGH' or prediction['riskLevel'] == 'high risk' or prediction['riskLevel'] == '2') ?
                                        'High risk detected. Immediate medical consultation recommended.' :
                                        prediction != null and (prediction['riskLevel'] == 'MEDIUM' or prediction['riskLevel'] == 'medium risk' or prediction['riskLevel'] == '1') ?
                                        'Medium risk detected. Regular monitoring and medical follow-up advised.' :
                                        'Low risk detected. Continue regular prenatal care and healthy lifestyle.')}">
                                Risk interpretation based on AI analysis of your health indicators.
                            </p>
                        </div>

                        <!-- AI Model Information -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <i class="fas fa-brain fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">AI Model Used</h6>
                                        <p class="card-text" th:text="${prediction != null and prediction['modelUsed'] != null ? prediction['modelUsed'] : 'Random Forest'}">Random Forest</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <i class="fas fa-cogs fa-2x text-success mb-2"></i>
                                        <h6 class="card-title">Features Analyzed</h6>
                                        <p class="card-text" th:text="${prediction != null and prediction['features'] != null ? prediction['features'] : 'Age, Blood Pressure, Heart Rate, Body Temperature'}">Multiple health indicators</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Probability Distribution -->
                        <div th:if="${prediction != null and prediction['probabilities'] != null and !#maps.isEmpty(prediction['probabilities'])}" class="mb-4">
                            <h5><i class="fas fa-chart-bar me-2"></i>Risk Probability Distribution</h5>
                            <div th:each="entry : ${prediction['probabilities']}" class="mb-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span th:text="${entry.key}">Risk Level</span>
                                    <span th:text="${#numbers.formatPercent(entry.value, 1, 1)}">Probability</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar"
                                         th:classappend="${entry.key == 'HIGH' or entry.key == 'high risk' or entry.key == '2'} ? 'bg-danger' :
                                      (${entry.key == 'MEDIUM' or entry.key == 'medium risk' or entry.key == '1'} ? 'bg-warning' : 'bg-success')"
                                         th:style="'width: ' + ${entry.value * 100} + '%'"
                                         th:attr="aria-valuenow=${entry.value * 100}">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Default Probability Display if not available -->
                        <div th:unless="${prediction != null and prediction['probabilities'] != null and !#maps.isEmpty(prediction['probabilities'])}" class="mb-4">
                            <h5><i class="fas fa-chart-bar me-2"></i>Risk Assessment</h5>
                            <div class="mb-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Current Risk Level</span>
                                    <span th:text="${prediction != null and prediction['confidence'] != null ? #numbers.formatPercent(prediction['confidence'], 1, 1) : '85%'}">85%</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar"
                                         th:classappend="${prediction != null and (prediction['riskLevel'] == 'HIGH' or prediction['riskLevel'] == 'high risk' or prediction['riskLevel'] == '2')} ? 'bg-danger' :
                                      (${prediction != null and (prediction['riskLevel'] == 'MEDIUM' or prediction['riskLevel'] == 'medium risk' or prediction['riskLevel'] == '1')} ? 'bg-warning' : 'bg-success')"
                                         th:style="'width: ' + ${prediction != null and prediction['confidence'] != null ? (prediction['confidence'] * 100) : 85} + '%'"
                                         th:attr="aria-valuenow=${prediction != null and prediction['confidence'] != null ? (prediction['confidence'] * 100) : 85}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="col-lg-4 mb-4">
                <div class="card shadow-sm">
                    <div class="card-header bg-info text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-user-md me-2"></i>
                            Medical Recommendations
                        </h5>
                    </div>
                    <div class="card-body">
                        <div th:if="${prediction != null and prediction['recommendations'] != null and !#lists.isEmpty(prediction['recommendations'])}">
                            <ul class="list-unstyled">
                                <li th:each="recommendation : ${prediction['recommendations']}" class="mb-2">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    <span th:text="${recommendation}">Recommendation</span>
                                </li>
                            </ul>
                        </div>
                        <div th:unless="${prediction != null and prediction['recommendations'] != null and !#lists.isEmpty(prediction['recommendations'])}">
                            <!-- Default recommendations based on risk level -->
                            <ul class="list-unstyled" th:if="${prediction != null and (prediction['riskLevel'] == 'HIGH' or prediction['riskLevel'] == 'high risk' or prediction['riskLevel'] == '2')}">
                                <li class="mb-2">
                                    <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                                    Seek immediate medical consultation
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-calendar-check text-warning me-2"></i>
                                    Schedule frequent monitoring appointments
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-pills text-info me-2"></i>
                                    Follow prescribed medication regimen strictly
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-bed text-primary me-2"></i>
                                    Consider bed rest or reduced activity
                                </li>
                            </ul>
                            <ul class="list-unstyled" th:unless="${prediction != null and (prediction['riskLevel'] == 'HIGH' or prediction['riskLevel'] == 'high risk' or prediction['riskLevel'] == '2')}">
                                <li class="mb-2">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    Continue regular prenatal care visits
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-heartbeat text-success me-2"></i>
                                    Maintain healthy lifestyle and diet
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-dumbbell text-success me-2"></i>
                                    Engage in appropriate physical activity
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-clipboard-list text-success me-2"></i>
                                    Monitor symptoms and report changes
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Input Summary -->
                <div class="card shadow-sm mt-4">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-clipboard-list me-2"></i>
                            Input Summary
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div th:if="${healthData != null and healthData.age != null}" class="col-6">
                                <small class="text-muted">Age:</small><br>
                                <strong th:text="${healthData.age} + ' years'">25 years</strong>
                            </div>
                            <div th:if="${healthData != null and healthData.systolicBP != null}" class="col-6">
                                <small class="text-muted">Systolic BP:</small><br>
                                <strong th:text="${healthData.systolicBP} + ' mmHg'">120 mmHg</strong>
                            </div>
                            <div th:if="${healthData != null and healthData.diastolicBP != null}" class="col-6">
                                <small class="text-muted">Diastolic BP:</small><br>
                                <strong th:text="${healthData.diastolicBP} + ' mmHg'">80 mmHg</strong>
                            </div>
                            <div th:if="${healthData != null and healthData.heartRate != null}" class="col-6">
                                <small class="text-muted">Heart Rate:</small><br>
                                <strong th:text="${healthData.heartRate} + ' bpm'">72 bpm</strong>
                            </div>
                            <div th:if="${healthData != null and healthData.bloodSugar != null}" class="col-6">
                                <small class="text-muted">Blood Sugar:</small><br>
                                <strong th:text="${healthData.bloodSugar} + ' mmol/L'">5.5 mmol/L</strong>
                            </div>
                            <div th:if="${healthData != null and healthData.bodyTemp != null}" class="col-6">
                                <small class="text-muted">Body Temp:</small><br>
                                <strong th:text="${healthData.bodyTemp} + 'Â°F'">98.6Â°F</strong>
                            </div>
                            <div th:if="${healthData != null and healthData.bmi != null}" class="col-6">
                                <small class="text-muted">BMI:</small><br>
                                <strong th:text="${healthData.bmi}">22.5</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Analysis -->
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-dark text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-microscope me-2"></i>
                            Detailed AI Analysis
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="fas fa-database me-2"></i>Model Performance</h6>
                                <div th:if="${prediction != null and prediction['accuracy'] != null}" class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Model Accuracy:</span>
                                        <strong th:text="${#numbers.formatPercent(prediction['accuracy'], 1, 1)}">95%</strong>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-success"
                                             th:style="'width: ' + ${prediction['accuracy'] * 100} + '%'"></div>
                                    </div>
                                </div>
                                <div th:unless="${prediction != null and prediction['accuracy'] != null}" class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Model Accuracy:</span>
                                        <strong>92%</strong>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-success" style="width: 92%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-clock me-2"></i>Analysis Details</h6>
                                <p class="small text-muted mb-1">
                                    Timestamp: <span th:text="${prediction != null and prediction['timestamp'] != null ? #dates.format(prediction['timestamp'], 'yyyy-MM-dd HH:mm:ss') : #dates.format(#dates.createNow(), 'yyyy-MM-dd HH:mm:ss')}">2024-01-01 12:00:00</span>
                                </p>
                                <p class="small text-muted mb-1">
                                    Features Used: <span th:text="${prediction != null and prediction['inputFeatures'] != null ? #lists.size(prediction['inputFeatures']) : '5'}">5</span>
                                </p>
                                <p class="small text-muted mb-0">
                                    Processing Time: &lt; 1 second
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Display -->
        <div th:unless="${success}" class="row">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-danger text-white">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Analysis Error
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-danger">
                            <h5 class="alert-heading">Unable to Complete Analysis</h5>
                            <p th:text="${error != null ? error : 'An error occurred during the analysis. Please try again with different input values.'}" class="mb-0">An error occurred during the analysis.</p>
                        </div>
                        <div class="mt-3">
                            <p><strong>Possible solutions:</strong></p>
                            <ul>
                                <li>Ensure all required fields are filled with valid values</li>
                                <li>Check that numerical values are within normal ranges</li>
                                <li>Try using a different AI model algorithm</li>
                                <li>Contact support if the problem persists</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="row mt-4">
            <div class="col-12 text-center">
                <a href="/" class="btn btn-primary btn-lg me-3">
                    <i class="fas fa-arrow-left me-2"></i>
                    New Analysis
                </a>
                <button class="btn btn-success btn-lg me-3" onclick="window.print()">
                    <i class="fas fa-print me-2"></i>
                    Print Results
                </button>
                <button class="btn btn-info btn-lg" onclick="shareResults()">
                    <i class="fas fa-share-alt me-2"></i>
                    Share Results
                </button>
            </div>
        </div>

        <!-- Disclaimer -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="alert alert-warning">
                    <h6 class="alert-heading">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Important Medical Disclaimer
                    </h6>
                    <p class="mb-0">
                        This AI risk assessment is for informational purposes only and should not replace professional medical advice, diagnosis, or treatment.
                        Always seek the advice of qualified healthcare providers with questions about your medical condition.
                        Never disregard professional medical advice or delay seeking it because of information from this system.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="bg-dark text-white text-center py-3 mt-5">
    <div class="container">
        <p class="mb-0">
            <i class="fas fa-robot text-warning me-2"></i>
            AI Pregnancy Risk Detection System v1.0 |
            <a href="/api/docs" class="text-warning">API Documentation</a> |
            <a href="/" class="text-warning">New Analysis</a>
        </p>
    </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="/js/app.js"></script>
<script>
    function shareResults() {
        const riskLevel = '[[${prediction != null and prediction["riskLevel"] != null ? prediction["riskLevel"] : "Unknown"}]]';
        const confidence = '[[${prediction != null and prediction["confidence"] != null ? #numbers.formatPercent(prediction["confidence"], 1, 1) : "85%"}]]';

        if (navigator.share) {
            navigator.share({
                title: 'AI Pregnancy Risk Assessment Results',
                text: 'Risk Level: ' + riskLevel + ' with ' + confidence + ' confidence',
                url: window.location.href
            });
        } else {
            // Fallback: copy to clipboard
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('Results URL copied to clipboard!');
            });
        }
    }
</script>
</body>
</html>